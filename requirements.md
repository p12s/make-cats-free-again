# Требования
## 1. Функциональные требования
- кот-тестировщик может:
  - автоматически попасть в систему, увидеть дашборд с заказанными услугами и кнопкой «запросить помощь»
  - при запросе помощи видеть форму, в которой можно описать, что нужно сделать, выбрать тип услуги, увидеть примерную стоимость
  - получить скидку (US-040)
  - подать заявку на позицию воркера
  - в конце недели увидеть инвойс на списание денег за оказанные услуги
  - видеть всю свою историю списаний/начислений (сколько клиент заплатит денег в конце текущей недели, а также список всех прошлых инвойсов и статус их оплат)
  - получать approve/decline по заявке на позиуию воркера
  - получить уведомление о сгенерированном инвойсе
  - получить уведомление об успешной/неуспешной оплате инвойса
   
- коты-разработчики алгоритма матчинга могут:
  - добавить/редактировать/удалять шаги алгоритма
    
- код-менеджер может:
  - задать типы услуг
  - увидеть заявку на позицию воркера, связаться с кондидатом
  - конфигурировать набор тестов для кота/позиции для потенциального кандидата
  - добавить в общий пул воркеров с полученными характеристиками (сильными/слабыми сторонами) и прочей информацией
  - забраковать кота по результатам тестирования
  - выбрать любой выполненный заказ и проверить качество выполненной работы, даже позвонить клиенту
  - увидеть отменённые или провальные заказы
  - занести результат проверки в отдельную форму по улучшению процессов
  - зачислить любое количество денег для выбранного воркера на своё усмотрение. Надо знать, кто и за что начислил деньги
  - ставить свои деньги на результат выполнения каждого заказа (менеджеры ставят сумму на заказ и условие. В поле выполнения или отмены или провала заказа система автоматически рассчитывает, кому и сколько денег надо отдать, банк делится между победителями)
  - получать уведомления о новых заявках на позицию воркера на почту
  - получать уведомления по изменению статуса услуги, подтверждение от клиента и воркера
  - отправить уведомление клиенту и воркеру о проверенном качестве работ
  
- кот-сотрудник отдела расходников может:
  - получить заявку-уведомление от воркера на расходники
  - отправить информацию о клиенте подрядчику - производителю печенек с предсказаниями
  - собрать итоговый набор расходников и уведомить воркера 
  
- кот-воркер может:
  - видеть список активных для него услуг, которые он должен помочь выполнить, а также список завершённых и отменённых услуг
  - получить необходимые для заказа расходники, включая бланк приёма работы. Т.е. запонлить заявку отделу сборки расходников, кому и подо что нужны расходники
  - по приезду к заказчику прислать фотографию и нажать кнопку «приступил»
  - после выполнения прислать фото отчета с подписью клиента
  - в конце месяца увидеть инвойс на зачисление денег за выполненные услуги
  - видеть всю свою историю списаний/начислений (сколько он заработал, штрафы и также инвойсы с их статусом)
  - получить уведомление в котором будет сказано, что он выбран в качестве исполнителя, где, когда и что надо будет сделать
  - получить уведомление чтобы он забрал свой пакет с расходниками для работы над заказом
  - получить уведомление о сгенерированном инвойсе
  - получить уведомление об оплате
  
## 2. Нефункциональные требования
- Защита от DDOS-атак
- Стандартные требования по отрасли по доступности/отзывчивости и тд.

## 3. Event Storming
- [US-010] Все коты-тестировщики (клиенты) автоматически попадают в систему. Для них доступен дашборд с заказанными услугами и кнопкой «запросить помощь».  
Изначально регистрации в новом сервисе нет, коты-тестировщики импортируются из текущей системы, поэтому регистрацию пока опустим.  
- [US-020] При запросе услуги клиенты будут видеть форму, в которой можно описать, что нужно сделать, выбрать тип услуги, увидеть примерную стоимость.
```
Тестировщик - Запросить помощь (описание, тип) - Событие "Помощь запрошена"
```
- [US-021] Типы услуги задаются в админке менеджерами.
```
Менеджер - Создать/Обновить/Удалить типы услуг - Событие "Типы услуг изменены"
```
- [US-030] Каждая выполненная или отменённая задача должна быть оплачена пользователем в полном объёме.
```
Событие "Услуга выполнена" - Списать деньги с баланса тестировщика - Событие "Оплата за выполнение услуги списана"
Событие "Услуга отменена" - Списать деньги с баланса тестировщика - Событие "Оплата за отмену услуги списана"
```
- [US-040] Если клиент заплатил больше 10 к условных кото-единиц в сумме, ему даётся скидка в 5%, если больше 20 к — скидка 6%. За каждые 10 к скидка увеличивается на 1%, предел скидки — 12%.  
- [US-050] Стоимость будет задаваться после подбора воркера под услугу (матчинга). Расчёт стоимости задаётся по секретной формуле, которую пока никто не знает, поэтому для первой версии хватит задать константное значение в 100 условных кото-единиц за любую услугу.  
Далее в расчетах используем предыдущие условия по скидкам (US-040)
```
Событие "Воркер под услугу подобран" - Расчитать и назначить итоговую стоимость по секретной формуле (пока просто константа 100 CAT) - Событие "Стоимость назначена"
```
- [US-060] Люди, которые придумывали уникальную систему матчинга, используют отличные от всей компании термины: «эталонный образец» (клиент) и «обычный образец» (воркер). Никто не знает, как так вышло, но разработчики алгоритма отказываются переучиваться.
- [US-070] Алгоритм матчинга — общий для любых образцов, состоит из набора шагов, по которым рассчитываются рейтинги и другие значения. Система чем-то похожа на map-reduce. Разработчики решили, что они сами будут реализовывать всю логику на любом языке, так как они не хотят делиться алгоритмом. Наша цель — использовать реализованные шаги в нужной нам последовательности, которая иногда может изменяться, при этом необходимо иметь возможность добавлять или редактировать шаги, как нам это необходимо.
  - [US-071] Для корректной работы матчинга необходима информация об обычных образцах (включая их сильные и слабые стороны) и результаты прошлых заказов.
  - [US-072] Матчинг принимает задачу и эталонный образец, а на выход выдаёт лучшего кандидата под задачу. Именно этого кандидата система автоматически назначает на задачу. И рассчитывает стоимость услуги.
- [US-080] Каждый кот, который хочет стать воркером компании MCF, должен пройти тестирование, чтобы компания была уверена, что кот входит в 3% лучших котов мира.
  - [US-081] Мы ожидаем 1к заявок в день от рандомных котов, также, судя по отзывам, наши конкуренты могут попытаться нас заддосить в этом месте. Они так делали уже несколько раз с другими компаниями, после чего компании закрывались с позором.
- [US-090] Для прохождения тестирования необходимо оставить заявку на сайте, после чего с котом связывается менеджер и назначает набор тестов, который оценит уровень потенциального кандидата.
```
Тестировщик - Оставить заявку на сайте - Событие "Заявка на воркера оставлена"
```
- [US-110] Менеджеры должны иметь возможность конфигурировать набор тестов под каждого отдельного кота или вакансию котов.
```
Менеджер - Конфигурирование набора тестов под кота или вакансию - Событие "Тесты обновлены"
```
- [US-120] По результатам тестов кот либо добавляется в общий пул рабочих с полученными характеристиками (сильными/слабыми сторонами) и прочей информацией о коте (имя, возраст, порода, цвет шерсти, фото), либо бракуется.
```
Менеджер - Добавить кота в воркеры/Отбраковать - Событие "Кот добавлен в пул воркеров/Кот отбракован"
```
- [US-130] Если воркер не придёт на заказ по любой причине, заказ автоматически проваливается и клиенту предлагается сделать новый заказ (по сути копию) на другую удобную дату. При этом под заказ подбирается новый воркер.
```
Событие "Заказ просрочен" - Вернуть заказ клиенту - Событие "Заказ возвращен клиенту как просроченный"
```
- [US-140] Воркер может видеть список активных для него услуг, которые он должен помочь выполнить, а также список завершённых и отменённых услуг.
- [US-150] Перед выездом на заказ воркер обязан получить необходимые для заказа расходники, включая бланк приёма работы. Для этого нам необходимо сказать отделу сборки расходников, кому и подо что нужны расходники.
```
Воркер - Сообщить отделу сборки расходников список - Событие "Список расходников отправлен" - Подтвердить получение расходников и бланк приема работ - Событие "расходники и бланк получены"
Менеджер - Подготовить расходники воркеру -  Событие "Список расходников подгтовлен"
```
- [US-160] Сотрудники отдела расходников сами собирают заказы на свой вкус, нам хватит только уведомить сотрудников о новом заказе и предоставить кнопку «выдано» под каждый заказ.
- [US-170] Думая о том, что ещё добавить для увеличения лояльности клиентов, топ-менеджмент решил воспользоваться LLM-based catGPT-4, который подсказал добавить fur-tune-печенья в заказ каждому клиенту с предсказанием будущего. Для этого компания нашла подрядчика, который готовит печенья и привозит их по каждому запросу специально под клиента в отдел сборки расходников. Чтобы печенье попало к клиенту, необходимо отправить информацию о клиенте подрядчику, и через 10 минут печенье приедет на склад, после чего сотрудники положат его в нужный набор расходников. Хоть получение каждого печенья поштучно под клиента выглядит странно, мы всё равно решили воспользоваться этой компанией.
```
Менеджер - Отправить информацию о клиенте подрядчику - Событие "Инфо подрядчику отправлено" - Доставить печенье на склад и положить в набор расходников - Событие "Печенье в расходники добавлено"
```
- [US-180] Когда воркер придёт в нужное время на заказ — ему необходимо отметиться в приложении (прислать фотографию и нажать кнопку «приступил»). В конце работы необходимо прислать фотографию бумажного отчёта с подписью клиента, что всё выполнено и претензий нет. 
```
Воркер - Прийти на заказ и отметиться - Событие "Воркер к работе приступил" - Выполнить работу, отправить фото отчета - Событие "Фото о выполнении работ отправлено"
```
- [US-190] Менеджеры могут случайно выбрать любой выполненный заказ и проверить качество выполненной работы. Для этого изучается вся информация по работе воркера. Иногда могут позвонить клиенту.
```
Менеджер - Отметить плохое качество работ - Событие "Проверено качество выполненной работы"
```
- [US-200] Все отменённые или провальные заказы автоматически попадают в отдел по изучению качества работы. Менеджеры пытаются понять, что случилось и как исправить ситуацию. Для этого могут связаться с клиентом.
- [US-210] Результат проверки качества заносится в отдельную форму, благодаря которой компания получает набор гипотез для улучшения бизнеса.
- [US-220] Каждую неделю (в воскресенье) у клиента списывается сумма, равная общим затратам на запрошенные задачи. Для этого выставляется инвойс, и дальше происходит процесс списания через заданный клиентом способ.
```
Автоматический сервис списаний - Выставить инвойс клиенту на списание - Событие "Инвойс на списание выставлен"
Событие "Инвойс на списание выставлен" - Списать еженедельную оплату - Событие "Еженедельная оплата списана"
```
- [US-230] Каждый последний день месяца воркеру начисляется сумма, равная общим выплатам минус все штрафы за текущий месяц. Для этого выставляется инвойс, и дальше происходит процесс зачисления средств через золотую шляпу.
```
Автоматический сервис начислений - Выставить инвойс воркеру на начисление - Событие "Инвойс на начисление выставлен"
Событие "Инвойс на начисление выставлен" - Зачислить месячную оплату - Событие "Месячная оплата зачислена"
```
- [US-240] Воркер получает 60% от стоимости выполненной задачи, отменённые задачи не оплачиваются, за провальные задачи воркер получает штраф в 40 условных кото-единиц.
- [US-250] Клиент и воркер должны видеть список всего, за что у них списались или начислились деньги.
- [US-260] Необходимо показывать, сколько клиент заплатит денег в конце текущей недели, а также список всех прошлых инвойсов и статус их оплат. Для воркера нужно показывать, сколько он заработал, штрафы и также инвойсы с их статусом.
- [US-270] Иногда менеджер может зачислить любое количество денег для выбранного воркера на своё усмотрение. Надо знать, кто и за что начислил деньги.
```
Менеджер - Зачислить любое количество денег для выбранного воркера (менеджер, сумма, причина) - Событие "Деньги воркеру зачислены"
```
- [US-280] Чтобы решить проблему низкой мотивации менеджеров MCF, была придумана система ставок. Эта система позволяет менеджерам ставить свои деньги на результат выполнения каждого заказа. Благодаря этому мы надеемся привлечь больше сотрудников в компанию. Ставки могут делать только менеджеры, которых будет не больше 15 человек. Мы не ожидаем большого количества ставок из-за общего количества заказов.
- [US-290] Вся логика ставок сводится к тому, что менеджеры ставят сумму на заказ и условие. В поле выполнения или отмены или провала заказа система автоматически рассчитывает, кому и сколько денег надо отдать (банк делится между победителями). Это не самый критически важный проект для компании, поэтому он вряд ли будет часто меняться.
```
Менеджер - Поставить деньги на результат выполнения заказа (заказ, сумма) - Событие "Деньги за ставку списаны" - Деньги перечисляются в банк
Событие "Заказ выполнен" - Расчет результа ставки, начисление на счета победителей - Событие "Выигрыш за ставку на заказ начислен"
```
- [US-300] В проекте должны быть нотификации. Все нотификации отправляются только на почту.
  - [US-301] Для флоу проверки необходимо сделать систему нотификаций, где будут уведомления по каждому шагу, по approve/decline воркеров в системе и по новым заявкам от котов.
  - [US-302] Для флоу заказа услуг необходимо сделать систему нотификаций, где будут уведомления по изменению статуса услуги, подтверждение от клиента и воркера.
  - [US-303] Когда расходники готовы — необходимо отправить нотификацию воркеру, чтобы он забрал свой пакет для работы над заказом.
  - [US-304] При генерации инвойса как для воркера, так и для клиента необходимо отправлять нотификацию. После успешной или неуспешной оплаты также необходимо отправлять нотификацию со статусом оплаты для клиентов. Для воркеров надо отправлять только оплаченные инвойсы.  
  - [US-305] После каждого изученного случая необходимо отправлять результат работы на почту как клиенту, так и воркеру.  
  - [US-306] Когда подберётся воркер под услугу, воркеру должна прийти нотификация, в которой будет сказано, где, когда и что надо будет сделать.  
Дополнить описанные выше шаги и события, чтобы там присутствовали все перечисленные в US-300 события.  
Сервис нотификаций будет просто реагировать на них и отправлять уведомления.  
  